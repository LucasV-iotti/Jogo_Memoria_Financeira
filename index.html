<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Jogo da Mem√≥ria ‚Äì Financeira (Tema Gal√°xia)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg1: #0b1020; --bg2: #121a36; --card: #1b2448; --accent: #8bf3ff; --ok: #5bd26a; --warn: #ffd166;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Color Emoji", "EmojiOne", sans-serif;
      color: #eef2ff; background: radial-gradient(1200px 800px at 20% 10%, #1a2150 0%, #0b1020 70%), linear-gradient(180deg, var(--bg2), var(--bg1));
      min-height: 100svh; display: grid; place-items: center; padding: 16px;
      overflow-x: hidden;
    }
    main { width: min(100%, 960px); }
    .screen { background: #0d1330a6; backdrop-filter: blur(6px); border: 1px solid #24306b; border-radius: 16px; padding: 20px; }
    .hidden { display: none !important; }
    h1, h2, h3 { margin: 0 0 12px; }
    .muted { opacity: .85; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    label { font-size: .95rem; }
    input[type="text"] {
      padding: 10px 12px; border-radius: 10px; border: 1px solid #2a376f; background: #0c1335; color: #e8ecff; width: 260px;
    }
    button {
      background: #22307a; color: #fff; border: 1px solid #3b4cb0; padding: 10px 14px; border-radius: 12px; cursor: pointer;
      transition: transform .06s ease, background .2s ease, box-shadow .2s ease;
    }
    button:disabled { opacity: .6; cursor: not-allowed; }
    button:hover { background: #2a3aa3; box-shadow: 0 6px 20px #1b2c8c60; }
    /* HUD e Tabuleiro */
    .hud { display: flex; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin: 12px 0; }
    .counters { display: flex; gap: 12px; flex-wrap: wrap; }
    .counter { background: #0f1744; border: 1px solid #23307a; padding: 8px 12px; border-radius: 10px; }
    .board {
      display: grid; gap: 10px; margin-top: 14px;
      grid-template-columns: repeat(6, minmax(70px, 1fr));
    }
    @media (max-width: 700px) {
      .board { grid-template-columns: repeat(3, minmax(80px, 1fr)); }
    }
    .card {
      position: relative; height: 110px; border-radius: 14px; perspective: 1000px;
    }
    .card button {
      position: absolute; inset: 0; width: 100%; height: 100%;
      border-radius: 14px; border: 1px solid #334087; background: #121a44; font-size: 40px; line-height: 1;
      transform-style: preserve-3d; transition: transform .45s cubic-bezier(.2,.7,.2,1), box-shadow .2s ease;
    }
    .card button:focus-visible { outline: 3px solid #78eaff; }
    .face { position: absolute; inset: 0; display: grid; place-items: center; backface-visibility: hidden; }
    .front { transform: rotateY(180deg); font-size: 44px; }
    .back  { background:
       radial-gradient(40% 60% at 30% 30%, #20308c 0%, transparent 60%),
       radial-gradient(40% 60% at 70% 70%, #162260 0%, transparent 55%), #131a40;
       color: #9fb6ff; font-weight: 600;
    }
    .is-flipped { transform: rotateY(180deg); box-shadow: 0 10px 30px #0c1a6c80; }
    .is-matched { box-shadow: 0 0 0 2px #4bd07b inset; }
    .tip { font-size: .95rem; color: #cfe6ff; opacity: .9; margin-top: 6px; }
    /* Modal pergunta */
    .modal { position: fixed; inset: 0; display: none; place-items: center; background: #0008; }
    .modal.open { display: grid; }
    .card-q { width: min(90vw, 720px); background: #0d1330; border: 1px solid #2b3a86; border-radius: 16px; padding: 18px; }
    .opts { display: grid; gap: 10px; margin-top: 10px; }
    .opt { text-align: left; }
    .badge { padding: 2px 8px; border-radius: 999px; background: #243080; font-size: .8rem; }
  </style>
</head>
<body>
<main>
  <!-- TELA INICIAL -->
  <section id="telaInicial" class="screen">
    <h1>üåå Jogo da Mem√≥ria ‚Äì Financeira</h1>
    <p class="muted">Tema: gal√°xia, universo, naves, foguetes e estrelas.</p>

    <div class="row" style="margin-top:10px">
      <label>Seu nome<br/>
        <input id="inpNome" type="text" placeholder="Ex.: Ana Souza" autocomplete="name" />
      </label>
      <div style="display:flex;gap:10px;align-items:flex-end">
        <button id="btnIr" disabled>Ir para o jogo üöÄ</button>
      </div>
    </div>

    <details style="margin-top:14px">
      <summary>üß† Regras do Jogo</summary>
      <ul>
        <li>Cartas: <b>12</b> (6 pares) com elementos do universo.</li>
        <li>Pr√©‚Äëvisualiza√ß√£o: veja todas por <b>20s</b> para memorizar.</li>
        <li>Ao formar um par, responda a <b>pergunta</b> para ganhar ponto extra.</li>
        <li>Pontua√ß√£o: <b>+2</b> por par; <b>+1</b> por resposta correta.</li>
      </ul>
    </details>
  </section>

  <!-- TELA DE JOGO -->
  <section id="telaJogo" class="screen hidden">
    <div class="hud">
      <div class="counters" aria-live="polite">
        <div class="counter">üë§ Jogador: <b id="hudNome">‚Äî</b></div>
        <div class="counter">‚úÖ Acertos: <b id="hudAcertos">0/6</b></div>
        <div class="counter">üéè Pares: <b id="hudPares">0/6</b></div>
        <div class="counter">‚≠ê Pontos: <b id="hudPontos">0</b></div>
      </div>
      <div class="row">
        <button id="btnPreview">üëÄ Pr√©‚Äëvisualiza√ß√£o 20s <span id="previewTimer"></span></button>
        <button id="btnReiniciar">üîÑ Reiniciar</button>
      </div>
    </div>

    <div id="board" class="board" aria-label="Tabuleiro do jogo de mem√≥ria"></div>
    <p class="tip">Dica: use a pr√©‚Äëvisualiza√ß√£o (20s) para memorizar as posi√ß√µes.</p>
  </section>

  <!-- TELA FINAL -->
  <section id="telaFinal" class="screen hidden">
    <h2>üåü Resultado Final</h2>
    <p>Jogador: <b id="outNome">‚Äî</b></p>
    <div class="row" style="gap:16px; margin: 8px 0">
      <span class="badge">‚úÖ Acertos: <b id="outAcertos">0/6</b></span>
      <span class="badge">üéè Pares: <b id="outPares">0/6</b></span>
      <span class="badge">‚≠ê Pontos totais: <b id="outPontos">0</b></span>
    </div>
    <button id="btnAgain">Jogar novamente üîÅ</button>
  </section>
</main>

<!-- Modal Pergunta -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="qTitle">
  <div class="card-q">
    <h3 id="qTitle">üß© Pergunta</h3>
    <p id="qText"></p>
    <div id="qOpts" class="opts"></div>
  </div>
</div>

<script>
  // ---------- UTIL ----------
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  // ---------- ESTADO ----------
  const EMOJIS = ["üöÄ","ü™ê","üåå","‚≠ê","üå†","üõ∞Ô∏è"]; // 6 pares
  const QUESTIONS = {
    "üöÄ": { q: "Voc√™ tem um sal√°rio e quer montar uma reserva de emerg√™ncia. Qual a regra mais indicada?",
            a: ["Guardar 6 a 12 meses de gastos essenciais", "Guardar 6 a 12 meses da renda total", "Investir tudo em a√ß√µes de alto risco"],
            ok: 0 },
    "ü™ê": { q: "Qual √© a ordem saud√°vel de finan√ßas pessoais?",
            a: ["Pagar d√≠vidas caras ‚Üí montar reserva ‚Üí investir objetivos", "Investir primeiro ‚Üí d√≠vidas ‚Üí reserva", "Ignorar d√≠vidas e focar em milhas"],
            ok: 0 },
    "üåå": { q: "O que √© juros compostos?",
            a: ["Juros sobre juros, aumentando o montante ao longo do tempo", "Um desconto aplicado s√≥ uma vez", "Taxa cobrada apenas no in√≠cio"],
            ok: 0 },
    "‚≠ê":  { q: "Qual exemplo de d√≠vida 'cara' que deve ser priorizada?",
            a: ["Cheque especial e rotativo do cart√£o", "Financiamento habitacional corrigido pela infla√ß√£o baixa", "Empr√©stimo consignado com juros baixos"],
            ok: 0 },
    "üå†": { q: "Qual pr√°tica ajuda a n√£o estourar o or√ßamento?",
            a: ["Fazer or√ßamento 50-30-20 (necessidades, desejos, poupan√ßa)", "Pagar tudo no cr√©dito sem acompanhamento", "Nunca olhar extrato"],
            ok: 0 },
    "üõ∞Ô∏è": { q: "Onde manter a reserva de emerg√™ncia?",
            a: ["Produto l√≠quido e baixo risco (ex.: Tesouro Selic, CDB alta liquidez)", "Cripto vol√°til", "A√ß√µes small caps"],
            ok: 0 },
  };

  let state;
  function newState() {
    const deck = [...EMOJIS, ...EMOJIS].map((icon, idx) => ({ id: idx, icon, matched: false }));
    // Fisher‚ÄìYates
    for (let i = deck.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    return {
      nome: "",
      deck,
      lock: false,
      flippedIds: [],
      pairs: 0, answersRight: 0, points: 0,
      previewing: false, previewTimer: 0,
      askedPairs: new Set(),
    };
  }

  // ---------- DOM & FLUXO ----------
  const inpNome = $("#inpNome");
  const btnIr   = $("#btnIr");

  function validateStart() { btnIr.disabled = !inpNome.value.trim(); }
  inpNome.addEventListener("input", validateStart);

  btnIr.addEventListener("click", () => {
    state = newState();
    state.nome = inpNome.value.trim();
    $("#hudNome").textContent = state.nome;
    go("#telaInicial", "#telaJogo");
    renderBoard();
    updateHUD();
  });

  $("#btnReiniciar").addEventListener("click", () => {
    const nome = state?.nome || inpNome.value.trim();
    state = newState();
    state.nome = nome;
    $("#hudNome").textContent = state.nome;
    renderBoard(); updateHUD();
  });

  $("#btnPreview").addEventListener("click", () => preview20s());
  $("#btnAgain").addEventListener("click", () => {
    go("#telaFinal", "#telaInicial");
    inpNome.focus();
  });

  function go(fromSel, toSel) {
    $(fromSel).classList.add("hidden");
    $(toSel).classList.remove("hidden");
  }

  function renderBoard() {
    const board = $("#board");
    board.innerHTML = "";
    state.deck.forEach(card => {
      const el = document.createElement("div");
      el.className = "card";
      const btn = document.createElement("button");
      btn.type = "button";
      btn.setAttribute("aria-label", "Carta de mem√≥ria");
      btn.dataset.id = card.id;
      btn.innerHTML = `
        <div class="face back">üß†</div>
        <div class="face front">${card.icon}</div>
      `;
      btn.addEventListener("click", onCardClick);
      el.appendChild(btn);
      board.appendChild(el);
    });
  }

  async function preview20s() {
    if (state.previewing) return;
    state.previewing = true;
    state.previewTimer = 20;
    updatePreviewBtn();
    const buttons = $$("#board .card button");
    buttons.forEach(b => b.classList.add("is-flipped"));
    const timer = setInterval(() => {
      state.previewTimer--;
      updatePreviewBtn();
      if (state.previewTimer <= 0) {
        clearInterval(timer);
        buttons.forEach(b => b.classList.remove("is-flipped"));
        state.previewing = false;
        updatePreviewBtn();
      }
    }, 1000);
  }

  function updatePreviewBtn() {
    $("#previewTimer").textContent = state.previewing ? ` (${state.previewTimer}s)` : "";
    $("#btnPreview").disabled = state.previewing || state.lock;
  }

  async function onCardClick(e) {
    if (state.lock || state.previewing) return;
    const btn = e.currentTarget;
    const id = +btn.dataset.id;
    const card = state.deck.find(c => c.id === id);
    if (card.matched) return;
    if (state.flippedIds.includes(id)) return;

    btn.classList.add("is-flipped");
    state.flippedIds.push(id);

    if (state.flippedIds.length === 2) {
      state.lock = true;
      const [aId, bId] = state.flippedIds;
      const a = state.deck.find(c => c.id === aId);
      const b = state.deck.find(c => c.id === bId);

      if (a.icon === b.icon) {
        a.matched = b.matched = true;
        [$(`[data-id="${aId}"]`), $(`[data-id="${bId}"]`)].forEach(btn => btn.classList.add("is-matched"));
        state.pairs++; state.points += 2; updateHUD();
        await askQuestionFor(a.icon);
        state.flippedIds = [];
        state.lock = false;
        if (state.pairs === 6) endGame();
      } else {
        await sleep(700);
        [$(`[data-id="${aId}"]`), $(`[data-id="${bId}"]`)].forEach(btn => btn.classList.remove("is-flipped"));
        state.flippedIds = [];
        state.lock = false;
      }
    }
  }

  function updateHUD() {
    $("#hudAcertos").textContent = `${state.answersRight}/6`;
    $("#hudPares").textContent   = `${state.pairs}/6`;
    $("#hudPontos").textContent  = `${state.points}`;
    updatePreviewBtn();
  }

  function endGame() {
    $("#outNome").textContent   = state.nome || "‚Äî";
    $("#outAcertos").textContent= `${state.answersRight}/6`;
    $("#outPares").textContent  = `${state.pairs}/6`;
    $("#outPontos").textContent = `${state.points}`;
    go("#telaJogo", "#telaFinal");
  }

  async function askQuestionFor(icon) {
    if (state.askedPairs.has(icon)) return;
    state.askedPairs.add(icon);

    const data = QUESTIONS[icon];
    if (!data) return;

    const modal = $("#modal");
    const qText = $("#qText");
    const qOpts = $("#qOpts");
    qText.textContent = data.q;
    qOpts.innerHTML = "";

    data.a.forEach((txt, idx) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "opt";
      btn.textContent = `‚Ä¢ ${txt}`;
      btn.addEventListener("click", () => {
        const correto = idx === data.ok;
        if (correto) {
          state.answersRight++; state.points += 1;
        }
        closeModal();
        updateHUD();
      });
      qOpts.appendChild(btn);
    });

    openModal();
    setTimeout(() => qOpts.querySelector("button")?.focus(), 0);

    function openModal() { modal.classList.add("open"); state.lock = true; }
    function closeModal() { modal.classList.remove("open"); state.lock = false; }
  }

  // Atalhos
  window.addEventListener("keydown", e => {
    if (e.key === "Escape" && $("#modal").classList.contains("open")) {
      $("#modal").classList.remove("open");
      state.lock = false;
      updateHUD();
    }
  });
  inpNome.addEventListener("keydown", e => { if (e.key === "Enter" && !btnIr.disabled) btnIr.click(); });

  // Inicial
  validateStart();
</script>
</body>
</html>
