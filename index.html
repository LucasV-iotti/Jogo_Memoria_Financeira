<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Jogo da Mem√≥ria ‚Äì Financeira</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      /* Tema claro em azul */
      --sky1:#eaf6ff;
      --sky2:#cfe9ff;
      --sky3:#b6defc;
      --text:#12324f;         /* azul-escuro leg√≠vel no claro */
      --muted:#4b6f97;        /* azul m√©dio para textos secund√°rios */
      --primary:#2b6cb0;      /* azul bot√£o */
      --primary-2:#1f5a99;
      --card:#ffffff;         /* face traseira */
      --card-front:#f4fbff;   /* face frontal */
      --chip:#f0f7ff;
      --border:#c9dcf3;
      --ok:#1f9d55;
      --err:#d64545;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
      color:var(--text);
      /* C√©u azul claro com ‚Äúobjetos do espa√ßo‚Äù estilizados em CSS */
      background:
        radial-gradient(1200px 600px at 20% 10%, var(--sky3) 0%, rgba(182,222,252,0) 60%),
        radial-gradient(800px 400px at 80% 0%, var(--sky2) 0%, rgba(207,233,255,0) 60%),
        linear-gradient(180deg, var(--sky1), var(--sky2));
      min-height:100%;
      display:flex; align-items:center; justify-content:center; padding:20px;
    }

    /* Camada de ‚Äúestrelas‚Äù e ‚Äúobjetos‚Äù (planetas, foguetes) com CSS puro */
    .space-objects::before, .space-objects::after{
      content:""; position:fixed; inset:0; pointer-events:none;
    }
    /* Estrelas mi√∫das */
    .space-objects::before{
      background:
        radial-gradient(1px 1px at 12% 24%, rgba(255,255,255,.9), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 34% 8%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 66% 18%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 84% 28%, rgba(255,255,255,.7), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 22% 72%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 58% 66%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 76% 80%, rgba(255,255,255,.7), rgba(255,255,255,0) 60%);
      opacity:.55;
    }
    /* Planeta e foguete estilizados com gradientes */
    .space-objects::after{
      background:
        /* Planeta lil√°s */
        radial-gradient(60px 60px at 85% 20%, #d9c2ff 20%, #b590ff 55%, rgba(0,0,0,0) 56%),
        radial-gradient(10px 10px at 82% 16%, rgba(255,255,255,.7) 30%, rgba(255,255,255,0) 31%),
        /* Anel do planeta */
        radial-gradient(80px 20px at 85% 21%, rgba(255,255,255,.6) 10%, rgba(255,255,255,0) 60%),
        /* Cometa azul */
        radial-gradient(6px 6px at 10% 70%, #ffffff 40%, rgba(255,255,255,0) 41%),
        linear-gradient( to right, rgba(255,255,255,.6), rgba(255,255,255,0) 60%) 0% 70% / 160px 2px no-repeat;
      opacity:.6;
    }

    .app{width:min(1040px,100%); position:relative}

    /* Telas */
    .screen{display:none;}
    .screen.active{display:block;}

    /* Painel cart√£o */
    .panel{
      background:rgba(255,255,255,.75);
      border:1px solid var(--border);
      backdrop-filter: blur(6px);
      border-radius:16px; padding:22px;
      box-shadow: 0 6px 20px rgba(31,90,153,.1);
    }
    h1{margin:0 0 8px 0; font-size:clamp(22px, 4.5vw, 32px)}
    h2{margin:16px 0 8px 0; font-size:clamp(18px, 3vw, 24px)}
    p,li{line-height:1.5; color:var(--muted)}
    ul{padding-left:18px; margin:8px 0}

    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .field{display:flex; flex-direction:column; gap:6px; min-width:220px; flex:1;}
    label{font-weight:600; color:var(--text)}
    input[type="text"]{
      padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#fff; color:var(--text); outline:none; min-height:40px;
    }
    button{
      border:0; border-radius:10px; padding:10px 14px; cursor:pointer; color:#fff;
      background:var(--primary); transition:transform .05s ease, filter .2s ease;
      min-height:40px;
    }
    button.secondary{ background:#4a89c7; }
    button:active{ transform:translateY(1px); }

    /* HUD e tabuleiro */
    .hud{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      margin:0 0 12px 0; font-weight:600;
    }
    .chip{
      background:var(--chip); border:1px solid var(--border); padding:8px 10px; border-radius:999px;
      color:var(--text);
    }
    .board{
      display:grid; grid-template-columns:repeat(4, minmax(80px, 1fr)); gap:12px;
    }
    .card{
      position:relative; aspect-ratio:3/4; border-radius:14px; perspective:900px; cursor:pointer;
      outline:none; border:0; background:transparent; padding:0;
    }
    .card.disabled{ pointer-events:none; }
    .card-inner{
      position:absolute; inset:0; border-radius:14px; transition:transform .5s;
      transform-style: preserve-3d;
    }
    .card.flipped .card-inner{ transform: rotateY(180deg); }
    .face{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      backface-visibility:hidden; border-radius:14px; font-size:clamp(28px,6vw,42px);
      border:1px solid var(--border);
    }
    .front{ background:var(--card-front); transform: rotateY(180deg); }
    .back{
      background:var(--card);
      /* pequenos elementos no verso */
      background-image:
        radial-gradient(circle at 30% 30%, rgba(43,108,176,.2) 0 6px, transparent 7px),
        radial-gradient(circle at 70% 70%, rgba(26, 86, 150, .18) 0 8px, transparent 9px);
      background-repeat:no-repeat;
    }

    dialog{
      border:1px solid var(--border); background:#fff; color:var(--text);
      border-radius:16px; padding:20px; width:min(560px, 94vw);
      box-shadow: 0 10px 30px rgba(18,50,79,.25);
    }
    dialog::backdrop{ background:rgba(0,0,0,.25); backdrop-filter: blur(2px); }
    .dialog-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:10px }
    .radio{
      display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px;
      border:1px solid var(--border); margin:6px 0;
      background:#f8fbff;
    }
    .muted{ color:var(--muted) }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    @media (max-width:520px){
      .board{ grid-template-columns:repeat(3, 1fr); }
    }
  </style>
</head>
<body>
  <div class="space-objects"></div>
  <div class="app">
    <!-- =================== TELA INICIAL =================== -->
    <section id="startScreen" class="screen active">
      <div class="panel">
        <h1>üåå Jogo da Mem√≥ria ‚Äì Financeira</h1>
        <p>Tema: Gal√°xia, universo, naves, foguetes e estrelas</p>

        <div class="row" style="margin:12px 0 8px 0;">
          <div class="field">
            <label for="playerName">Seu nome</label>
            <input id="playerName" name="playerName" type="text" placeholder="Digite seu nome" required>
          </div>
          <div class="row" style="gap:8px; align-self:flex-end">
            <button class="secondary" id="previewBtn" type="button">Pr√©‚Äëvisualiza√ß√£o 20s üëÄ</button>
            <button id="startBtn" type="button">Ir para o jogo üöÄ üß†</button>
          </div>
        </div>
        <p id="previewCountdown" class="muted" aria-live="polite" style="min-height:1.5em"></p>

        <h2>Regras do Jogo</h2>
        <ul>
          <li>Cartas e Tema: 12 cartas com elementos do universo. H√° 6 pares.</li>
          <li>Pr√©‚Äëvisualiza√ß√£o (20s): veja todas as cartas para memorizar.</li>
          <li>Jogada + pergunta: vire 2 cartas; formando par, responda a pergunta.</li>
          <li>Pontua√ß√£o: par = +2; resposta certa = +1.</li>
        </ul>
        <p class="hint muted">Dica: Voc√™ pode usar a pr√©‚Äëvisualiza√ß√£o (20s) para memorizar as posi√ß√µes.</p>
      </div>
    </section>

    <!-- =================== TELA DE JOGO =================== -->
    <section id="gameScreen" class="screen">
      <div class="hud">
        <span id="hudName" class="chip">üë§ ‚Äî</span>
        <span id="hudQuiz" class="chip">‚úÖ Acertos: 0/6</span>
        <span id="hudPairs" class="chip">üéè Pares: 0/6</span>
        <span id="hudScore" class="chip">‚≠ê Pontos: 0</span>
      </div>

      <div class="row" style="margin-bottom:10px; gap:8px">
        <button class="secondary" id="previewInGame" type="button">Pr√©‚Äëvisualiza√ß√£o 20s üëÄ</button>
        <span class="muted" id="countdownInGame" aria-live="polite"></span>
        <button id="restartBtn" class="secondary" type="button" title="Reiniciar">‚Ü∫ Reiniciar</button>
      </div>

      <div id="board" class="board" role="grid" aria-label="Cartas do jogo"></div>
      <p class="muted" style="margin-top:8px">Pr√©‚Äëvisualiza√ß√£o 20s üëÄ <span id="countdownFooter" aria-live="polite">20s</span> Iniciar jogo ‚ñ∂Ô∏è</p>
    </section>

    <!-- =================== DI√ÅLOGO DE PERGUNTA =================== -->
    <dialog id="questionDlg" aria-labelledby="qTitle" aria-describedby="qText">
      <h3 id="qTitle">Pergunta</h3>
      <p id="qText" class="muted">Enunciado</p>
      <form id="qForm" method="dialog">
        <div id="qOptions"></div>
        <div class="dialog-actions">
          <button class="secondary" value="cancel">Pular</button>
          <button value="ok">Responder</button>
        </div>
      </form>
      <p id="qFeedback" class="muted" aria-live="polite"></p>
    </dialog>

    <!-- =================== RESULTADO FINAL =================== -->
    <dialog id="resultDlg" aria-labelledby="rTitle">
      <h3 id="rTitle">üåü Resultado Final</h3>
      <div class="grid-2">
        <ul>
          <li id="rPlayer">Jogador: ‚Äî</li>
          <li id="rPairs">üéè Pares: 0/6</li>
        </ul>
        <ul>
          <li id="rQuiz">‚úÖ Acertos: 0/6</li>
          <li id="rScore">‚≠ê Pontos totais: 0</li>
        </ul>
      </div>
      <div class="dialog-actions" style="margin-top:4px">
        <button id="playAgain" value="ok">Jogar novamente üîÑ</button>
      </div>
    </dialog>
  </div>

  <script>
    /***************
     * STATE & DATA
     ***************/
    const symbols = ["üöÄ","üõ∏","üåï","ü™ê","‚òÑÔ∏è","üå†"]; // 6 pares
    const questions = [
      { text: "O que √© um or√ßamento pessoal?",
        options: ["Um registro do dinheiro que entra e sai", "Um tipo de investimento de alto risco", "Um empr√©stimo"],
        correct: 0, feedback: "Or√ßamento √© o acompanhamento de receitas e despesas." },
      { text: "Juros compostos significam‚Ä¶",
        options: ["Juros sobre o valor inicial apenas", "Juros sobre juros acumulados", "Igual a juros simples"],
        correct: 1, feedback: "Nos compostos, os juros incidem sobre principal + juros acumulados." },
      { text: "Reserva de emerg√™ncia ideal √©, em geral:",
        options: ["1 m√™s de despesas", "3 a 6 meses de despesas", "12 meses fixos"],
        correct: 1, feedback: "Recomenda√ß√£o comum: entre 3 e 6 meses de despesas." },
      { text: "Uma d√≠vida com juros maiores deve ser:",
        options: ["A √∫ltima a ser paga", "Priorizada para pagamento", "Ignorada"],
        correct: 1, feedback: "Priorizar d√≠vidas mais caras reduz o custo total." },
      { text: "Parcelar compras sem juros‚Ä¶",
        options: ["N√£o impacta o or√ßamento", "Pode comprometer o fluxo de caixa", "Sempre √© melhor que √† vista"],
        correct: 1, feedback: "Mesmo sem juros, parcelas ocupam or√ßamento futuro." },
      { text: "Investimento com maior risco tende a‚Ä¶",
        options: ["Ter retorno garantido", "Oscilar mais e poder render mais", "Render menos que a poupan√ßa"],
        correct: 1, feedback: "Maior risco costuma vir com maior volatilidade e potencial retorno." }
    ];

    const $ = (s, root=document) => root.querySelector(s);
    const $$ = (s, root=document) => [...root.querySelectorAll(s)];

    const screens = {
      start: $("#startScreen"),
      game: $("#gameScreen"),
    };

    const els = {
      name: $("#playerName"),
      startBtn: $("#startBtn"),
      previewBtn: $("#previewBtn"),
      previewInGame: $("#previewInGame"),
      previewCountdown: $("#previewCountdown"),
      countdownInGame: $("#countdownInGame"),
      countdownFooter: $("#countdownFooter"),
      board: $("#board"),
      restartBtn: $("#restartBtn"),

      // HUD
      hudName: $("#hudName"),
      hudPairs: $("#hudPairs"),
      hudQuiz: $("#hudQuiz"),
      hudScore: $("#hudScore"),

      // Dialogs
      qDlg: $("#questionDlg"),
      qText: $("#qText"),
      qForm: $("#qForm"),
      qOptions: $("#qOptions"),
      qFeedback: $("#qFeedback"),

      rDlg: $("#resultDlg"),
      rPlayer: $("#rPlayer"),
      rPairs: $("#rPairs"),
      rQuiz: $("#rQuiz"),
      rScore: $("#rScore"),
      playAgain: $("#playAgain"),
    };

    const state = {
      name: "‚Äî",
      deck: [],
      flipped: [],
      lock: false,
      pairs: 0,
      quizRight: 0,
      score: 0,
      previewLeft: 0,
      askedIndexes: new Set()
    };

    /********************
     * UTILS & RENDERING
     ********************/
    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function createDeck(){
      const pairs = symbols.flatMap((sym, idx)=>[
        { id:`${idx}-A`, pair: idx, sym },
        { id:`${idx}-B`, pair: idx, sym },
      ]);
      return shuffle(pairs);
    }

    function renderBoard(){
      els.board.innerHTML = "";
      state.deck.forEach((card, index)=>{
        const btn = document.createElement("button");
        btn.className = "card";
        btn.setAttribute("role","button");
        btn.setAttribute("aria-label","Carta virada");
        btn.dataset.index = index;
        btn.innerHTML = `
          <div class="card-inner">
            <div class="face front"><span>${card.sym}</span></div>
            <div class="face back"><span>ü™ê</span></div>
          </div>`;
        btn.addEventListener("click", ()=>onFlip(btn, index));
        els.board.appendChild(btn);
      });
    }

    function updateHUD(){
      els.hudName.textContent = `üë§ ${state.name}`;
      els.hudPairs.textContent = `üéè Pares: ${state.pairs}/6`;
      els.hudQuiz.textContent = `‚úÖ Acertos: ${state.quizRight}/6`;
      els.hudScore.textContent = `‚≠ê Pontos: ${state.score}`;
    }

    function showScreen(target){
      $$(".screen").forEach(s=>s.classList.remove("active"));
      target.classList.add("active");
    }

    /******************
     * GAME MECHANICS
     ******************/
    function resetGame(keepName=false){
      const oldName = state.name;
      Object.assign(state, {
        name: keepName ? oldName : "‚Äî",
        deck: createDeck(),
        flipped: [],
        lock: false,
        pairs: 0,
        quizRight: 0,
        score: 0,
        previewLeft: 0,
        askedIndexes: new Set()
      });
      renderBoard();
      updateHUD();
      stopPreview(); // garante que n√£o h√° preview ativo
    }

    function onFlip(btn, index){
      if(state.lock) return;
      const card = state.deck[index];
      if(btn.classList.contains("flipped")) return;

      btn.classList.add("flipped");
      state.flipped.push({btn,index,card});

      if(state.flipped.length === 2){
        state.lock = true;
        const [a,b] = state.flipped;
        if(a.card.pair === b.card.pair){
          state.pairs++;
          state.score += 2;
          setTimeout(()=>{
            a.btn.classList.add("disabled");
            b.btn.classList.add("disabled");
            updateHUD();
            askQuestion().then(()=>{
              if(state.pairs === 6){ endGame(); }
              state.flipped = [];
              state.lock = false;
            });
          }, 300);
        }else{
          setTimeout(()=>{
            a.btn.classList.remove("flipped");
            b.btn.classList.remove("flipped");
            state.flipped = [];
            state.lock = false;
          }, 650);
        }
      }
    }

    function askQuestion(){
      return new Promise(resolve=>{
        // escolhe primeira n√£o utilizada; se acabar, reaproveita aleat√≥ria
        const available = questions.map((_,i)=>i).filter(i=>!state.askedIndexes.has(i));
        const idx = available.length ? available[0] : Math.floor(Math.random()*questions.length);
        state.askedIndexes.add(idx);
        const q = questions[idx];

        $("#qOptions").innerHTML = "";
        $("#qText").textContent = q.text;
        q.options.forEach((opt, i)=>{
          const id = `opt${idx}_${i}`;
          const wrap = document.createElement("label");
          wrap.className = "radio";
          wrap.innerHTML = `
            <input type="radio" name="q" id="${id}" value="${i}">
            <span>${opt}</span>
          `;
        $("#qOptions").appendChild(wrap);
        });
        $("#qFeedback").textContent = "";

        els.qDlg.showModal();

        els.qForm.onsubmit = (ev)=>{
          ev.preventDefault();
          const choice = els.qForm.querySelector('input[name="q"]:checked');
          if(!choice){ $("#qFeedback").textContent = "Selecione uma op√ß√£o."; return; }
          const correct = Number(choice.value) === q.correct;
          $("#qFeedback").textContent = correct
            ? `‚úÖ Correto! ${q.feedback}`
            : `‚ùå N√£o √© bem isso. ${q.feedback}`;
          if(correct){
            state.quizRight++;
            state.score++;
            updateHUD();
          }
          setTimeout(()=>{ els.qDlg.close("ok"); resolve(); }, 650);
        };
        els.qDlg.addEventListener("close", ()=>resolve(), { once:true });
      });
    }

    function endGame(){
      els.rPlayer.textContent = `Jogador: ${state.name}`;
      els.rPairs.textContent = `üéè Pares: ${state.pairs}/6`;
      els.rQuiz.textContent = `‚úÖ Acertos: ${state.quizRight}/6`;
      els.rScore.textContent = `‚≠ê Pontos totais: ${state.score}`;
      els.rDlg.showModal();
    }

    /*****************
     * PREVIEW (20s)
     *****************/
    let ticker = null;
    function startPreview(){
      $$(".card").forEach(c=>c.classList.add("flipped"));
      state.previewLeft = 20;
      updateCountdownUI();
      clearInterval(ticker);
      ticker = setInterval(()=>{
        state.previewLeft--;
        updateCountdownUI();
        if(state.previewLeft<=0){ stopPreview(); }
      }, 1000);
    }
    function stopPreview(){
      clearInterval(ticker); ticker=null;
      $$(".card").forEach(c=>{ if(!c.classList.contains("disabled")) c.classList.remove("flipped"); });
      state.previewLeft = 0;
      updateCountdownUI();
    }
    function updateCountdownUI(){
      const txt = state.previewLeft>0 ? `Pr√©‚Äëvisualiza√ß√£o: ${state.previewLeft}s` : "";
      $("#previewCountdown").textContent = txt;
      $("#countdownInGame").textContent = txt;
      $("#countdownFooter").textContent = state.previewLeft>0 ? `${state.previewLeft}s` : "20s";
    }

    /************
     * HANDLERS
     ************/
    $("#previewBtn").addEventListener("click", ()=>{
      resetGame(true);
      showScreen(screens.game);
      startPreview();
    });

    $("#previewInGame").addEventListener("click", ()=> startPreview());

    $("#startBtn").addEventListener("click", ()=>{
      const name = $("#playerName").value.trim();
      state.name = name || "‚Äî";
      resetGame(true);
      updateHUD();
      showScreen(screens.game);
    });

    $("#restartBtn").addEventListener("click", ()=> resetGame(true));

    $("#playAgain").addEventListener("click", ()=>{
      els.rDlg.close();
      resetGame(true);
      showScreen(screens.start);
    });

    // boot
    resetGame(false);
  </script>
</body>
</html>
